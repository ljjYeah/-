### 性能优化

#### 性能优化的指标和工具
- 加载
  - speed index： lighthouse里面查看，如果大于4s，表示要优化了
  - TTFB：请求发出去到请求回来的时间
  - 页面加载时间：DOMContentLoaded && load
  - 首次渲染
  
- 响应
  - 交互动作的反馈时间
  - 帧率FPS：最起码1s中60帧以上不会卡，command+shift+p在performance里面查看 frame
  - 异步请求的完成时间： 1s回来，如果不行，就压缩并加loading样式
  
- 测量模型
  - RAIL
    - response响应：网站对用户的响应
    - animation动画
    - idle空闲：让浏览器有足够的空闲时间，performance里面查看
    - load加载
  - RAIL评估标准
    - 响应：处理事件应在50ms以内完成
    - 动画：每10ms产生一帧
    - 空闲：尽可能增加空闲时间 
    - 加载：在5s内完成内容加载并可以交互
  
- 性能测量工具
  - chrome devTools开发调试、性能评测
    - performance esc
  - lighthouse网站整体质量评估
    - npm install lighthouse -g
    - lighthouse https://www.baidu.com
    - command+shift+p在performance里面过滤加载文件 block
  - webPageTest多测试地点、全面性能报告
    - 本地部署
    - 1.docker pull webpagetest/server
    - 2.docker pull webpagetest/agent
    - 3.docker run -d -p 4000:80 webpagetest/server
    - 4.docker run -d -p 4001:80 --network="host" -e "SERVER_URL=http://localhost:4000/work/" -e "LOCATION=Test" webpagetest/agent
    - 5.mkdir wpt-mac-server
    - 6.cd wpt-mac-server
    - 7.vim Dockerfile
    - 8.vim location.ini
    - 9.........
  
- 性能测量api
  - 关键时间节点（Navigation Timing，Resource Timing）
    - 检测长任务
  - 网络状态（Network APIs）
  - 客户端服务端协商（HTTP Client Hints） & 网页显示状态（UI APIs）
  
#### 渲染优化
- 浏览器的渲染流程
  
  1.javascript
  
  2.style
  
  3.layout

  4.paint

  5.composite

- 渲染过程
  - 构建DOM对象
  - 构建CSSOM对象
  - 构建渲染树
  
- 布局与绘制
  - 渲染树只包含网页需要的节点
  - 布局计算每个节点精确的位置和大小-盒模型
  - 绘制是像素化每个节点的过程
  
- 影响回流（reflow）的操作
  - 添加/删除元素
  - display:none
  - 移动元素位置
  - 操作styles
  - offsetLeft、scrollTop、clientWidth
  - 移动元素位置
  - 修改浏览器大小，字体大小
  
- 避免layout thrashing布局抖动
  - 避免回流
    - 使用transform替代bottom、left。。。。
    - 虚拟dom
    - 动画requestAnimationFrame
  - 读写分离
    - 读取布局
    - 赋值操作
  
- fastdom解决布局抖动
- 复合线程（compositor thread）
  - 将页面拆分图层进行绘制在进行复合
  
与图层（layers）
  
